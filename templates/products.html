{% extends "base.html" %}
{% block content %}
<h2>Product Listings</h2>

<form method="GET" action="{{ url_for('index') }}" class="row mb-4">
  <div class="col-md-6">
    <input type="text" name="search" class="form-control"
           placeholder="Search by title..."
           value="{{ search_query }}">
  </div>
  <div class="col-md-4">
    <select name="category" class="form-select">
      <option value="">All Categories</option>
      {% for c in categories %}
        <option value="{{ c }}" {% if category_filter == c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary w-100">Filter</button>
  </div>
</form>

<div class="row">
  {% for p in products %}
  <div class="col-md-4 d-flex align-items-stretch">
    <div class="card mb-4 border-0 shadow-sm">
      <img src="{{ p.image }}" class="card-img-top" alt="Product" style="height:220px;object-fit:cover;border-radius:16px 16px 0 0;">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title fw-bold text-success"><i class="bi bi-box-seam me-1"></i> {{ p.title }}</h5>
        <p class="card-text mb-2"><i class="bi bi-currency-dollar"></i> {{ p.price }} <span class="badge bg-success ms-2"><i class="bi bi-leaf me-1"></i>{{ p.category }}</span></p>
        <p class="card-text text-muted" style="min-height:40px;">{{ p.description }}</p>
        <div class="mt-auto">
          {% if current_user.is_authenticated %}
            <a href="{{ url_for('add_to_cart', pid=p.id) }}" class="btn btn-warning w-100"><i class="bi bi-cart-plus me-1"></i> Add to Cart</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
