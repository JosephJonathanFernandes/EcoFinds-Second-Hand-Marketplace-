{% extends "base.html" %}
{% block title %}Join EcoFinds - Register{% endblock %}

{% block content %}
<!-- Registration Section -->
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
      <div class="card border-0 shadow-lg">
        <div class="card-header bg-success text-white text-center py-4">
          <h3 class="fw-bold mb-2">
            <i class="bi bi-person-plus me-2"></i>Join EcoFinds
          </h3>
          <p class="mb-0">Start your sustainable shopping journey today</p>
        </div>
        <div class="card-body p-5">
          <form method="POST" id="registerForm">
            <div class="row">
              <div class="col-md-6 mb-4">
                <label class="form-label fw-semibold">
                  <i class="bi bi-envelope me-1"></i>Email Address *
                </label>
                <input type="email" name="email" class="form-control form-control-lg" 
                       placeholder="Enter your email" required>
                <div class="form-text">We'll never share your email</div>
              </div>
              
              <div class="col-md-6 mb-4">
                <label class="form-label fw-semibold">
                  <i class="bi bi-person me-1"></i>Username *
                </label>
                <input type="text" name="username" class="form-control form-control-lg" 
                       placeholder="Choose a username" required>
                <div class="form-text">This will be visible to other users</div>
              </div>
            </div>

            <div class="mb-4">
              <label class="form-label fw-semibold">
                <i class="bi bi-lock me-1"></i>Password *
              </label>
              <div class="position-relative">
                <input type="password" name="password" class="form-control form-control-lg" 
                       placeholder="Create a strong password" required id="passwordInput">
                <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y" 
                        onclick="togglePassword()" style="z-index: 10;">
                  <i class="bi bi-eye" id="toggleIcon"></i>
                </button>
              </div>
              <div class="form-text">
                <div class="password-strength mt-2">
                  <div class="progress" style="height: 4px;">
                    <div class="progress-bar" id="strengthBar" style="width: 0%"></div>
                  </div>
                  <small id="strengthText" class="text-muted">Password strength</small>
                </div>
              </div>
            </div>

            <div class="mb-4">
              <label class="form-label fw-semibold">
                <i class="bi bi-lock-fill me-1"></i>Confirm Password *
              </label>
              <input type="password" name="confirm_password" class="form-control form-control-lg" 
                     placeholder="Confirm your password" required id="confirmPasswordInput">
              <div class="form-text" id="passwordMatch"></div>
            </div>

            <div class="mb-4">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                <label class="form-check-label" for="agreeTerms">
                  I agree to the <a href="#" class="text-success">Terms of Service</a> and <a href="#" class="text-success">Privacy Policy</a>
                </label>
              </div>
            </div>

            <div class="mb-4">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="newsletter">
                <label class="form-check-label" for="newsletter">
                  Send me eco-friendly tips and updates about new features
                </label>
              </div>
            </div>

            <button type="submit" class="btn btn-success btn-lg w-100 mb-3">
              <i class="bi bi-person-plus me-2"></i>Create Account
            </button>

            <div class="text-center">
              <p class="text-muted mb-0">Already have an account? 
                <a href="{{ url_for('login') }}" class="text-success fw-semibold text-decoration-none">
                  Sign in here
                </a>
              </p>
            </div>
          </form>
        </div>
      </div>

      <!-- Benefits Section -->
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-body">
          <h5 class="fw-bold text-center mb-4">Why Join Our Community?</h5>
          <div class="row g-4">
            <div class="col-md-6">
              <div class="d-flex align-items-start">
                <i class="bi bi-leaf text-success me-3 mt-1" style="font-size: 1.5rem;"></i>
                <div>
                  <h6 class="fw-semibold mb-1">Eco-Friendly</h6>
                  <p class="text-muted small mb-0">Reduce waste and promote sustainable consumption</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-start">
                <i class="bi bi-currency-dollar text-success me-3 mt-1" style="font-size: 1.5rem;"></i>
                <div>
                  <h6 class="fw-semibold mb-1">Save Money</h6>
                  <p class="text-muted small mb-0">Find amazing deals on quality pre-loved items</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-start">
                <i class="bi bi-people text-success me-3 mt-1" style="font-size: 1.5rem;"></i>
                <div>
                  <h6 class="fw-semibold mb-1">Community</h6>
                  <p class="text-muted small mb-0">Connect with like-minded eco-conscious individuals</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-start">
                <i class="bi bi-graph-up text-success me-3 mt-1" style="font-size: 1.5rem;"></i>
                <div>
                  <h6 class="fw-semibold mb-1">Track Impact</h6>
                  <p class="text-muted small mb-0">Monitor your environmental contribution</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Security Notice -->
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-body text-center">
          <i class="bi bi-shield-check text-success mb-2" style="font-size: 2rem;"></i>
          <h6 class="fw-bold mb-2">Your Data is Secure</h6>
          <p class="text-muted small mb-0">
            We use industry-standard encryption to protect your personal information. 
            Your privacy and security are our top priorities.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Toggle password visibility
  function togglePassword() {
    const passwordInput = document.getElementById('passwordInput');
    const toggleIcon = document.getElementById('toggleIcon');
    
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      toggleIcon.className = 'bi bi-eye-slash';
    } else {
      passwordInput.type = 'password';
      toggleIcon.className = 'bi bi-eye';
    }
  }

  // Password strength checker
  function checkPasswordStrength(password) {
    let strength = 0;
    let strengthText = '';
    let strengthColor = '';

    if (password.length >= 8) strength += 25;
    if (password.match(/[a-z]/)) strength += 25;
    if (password.match(/[A-Z]/)) strength += 25;
    if (password.match(/[0-9]/)) strength += 25;

    if (strength < 25) {
      strengthText = 'Very Weak';
      strengthColor = '#dc3545';
    } else if (strength < 50) {
      strengthText = 'Weak';
      strengthColor = '#fd7e14';
    } else if (strength < 75) {
      strengthText = 'Good';
      strengthColor = '#ffc107';
    } else {
      strengthText = 'Strong';
      strengthColor = '#28a745';
    }

    document.getElementById('strengthBar').style.width = strength + '%';
    document.getElementById('strengthBar').style.backgroundColor = strengthColor;
    document.getElementById('strengthText').textContent = strengthText;
    document.getElementById('strengthText').style.color = strengthColor;
  }

  // Password confirmation checker
  function checkPasswordMatch() {
    const password = document.getElementById('passwordInput').value;
    const confirmPassword = document.getElementById('confirmPasswordInput').value;
    const matchText = document.getElementById('passwordMatch');

    if (confirmPassword === '') {
      matchText.textContent = '';
      matchText.className = 'form-text';
      return;
    }

    if (password === confirmPassword) {
      matchText.textContent = '✓ Passwords match';
      matchText.className = 'form-text text-success';
    } else {
      matchText.textContent = '✗ Passwords do not match';
      matchText.className = 'form-text text-danger';
    }
  }

  // Event listeners
  document.getElementById('passwordInput').addEventListener('input', function() {
    checkPasswordStrength(this.value);
    checkPasswordMatch();
  });

  document.getElementById('confirmPasswordInput').addEventListener('input', checkPasswordMatch);

  // Form validation
  document.getElementById('registerForm').addEventListener('submit', function(e) {
    const email = document.querySelector('input[name="email"]').value.trim();
    const username = document.querySelector('input[name="username"]').value.trim();
    const password = document.querySelector('input[name="password"]').value;
    const confirmPassword = document.querySelector('input[name="confirm_password"]').value;
    const agreeTerms = document.getElementById('agreeTerms').checked;

    if (!email || !username || !password || !confirmPassword) {
      e.preventDefault();
      alert('Please fill in all required fields');
      return;
    }

    if (!isValidEmail(email)) {
      e.preventDefault();
      alert('Please enter a valid email address');
      return;
    }

    if (username.length < 3) {
      e.preventDefault();
      alert('Username must be at least 3 characters long');
      return;
    }

    if (password.length < 8) {
      e.preventDefault();
      alert('Password must be at least 8 characters long');
      return;
    }

    if (password !== confirmPassword) {
      e.preventDefault();
      alert('Passwords do not match');
      return;
    }

    if (!agreeTerms) {
      e.preventDefault();
      alert('Please agree to the Terms of Service and Privacy Policy');
      return;
    }

    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Creating Account...';
    submitBtn.disabled = true;
  });

  // Email validation
  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  // Auto-focus on email field
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('input[name="email"]').focus();
  });
</script>
{% endblock %}
